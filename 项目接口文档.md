# ITEams - IT资产管理系统接口文档

## 接口规范

### 基础URL
```
http://localhost:8080/api
```

### 响应格式
所有接口返回统一的JSON格式：

```json
{
  "success": true,          // 操作是否成功
  "code": "200",            // 状态码，成功为"200"，失败为自定义错误码
  "message": "操作成功",     // 提示消息
  "data": {},               // 数据负载，根据接口不同而不同
  "timestamp": 1618037235000 // 响应时间戳
}
```

### 错误处理
当请求失败时，返回格式为：

```json
{
  "success": false,
  "code": "500",        // 或其他错误码
  "message": "错误描述", // 详细错误信息
  "timestamp": 1618037235000
}
```

## 资产导入相关接口

### 1. 上传Excel文件导入资产

**接口描述**：上传Excel格式的资产数据文件，系统将异步处理导入

**请求方法**：POST

**URL**：`/api/import/excel`

**Content-Type**：`multipart/form-data`

**请求参数**：

| 参数名 | 类型   | 必填 | 说明                           |
|--------|--------|------|--------------------------------|
| file   | File   | 是   | Excel文件(.xlsx或.xls格式)     |

**响应参数**：

| 参数名    | 类型   | 说明                                |
|-----------|--------|-------------------------------------|
| data      | String | 导入任务ID，用于后续查询导入进度    |

**响应示例**：
```json
{
  "success": true,
  "code": "200",
  "message": "文件上传成功，开始处理",
  "data": "import-task-20240318-a1b2c3",
  "timestamp": 1618037235000
}
```

**错误码**：

| 错误码 | 描述               | 解决方案                   |
|--------|--------------------|-----------------------------|
| 500    | 文件不能为空       | 确保上传了有效的Excel文件   |
| 500    | 只支持Excel文件格式 | 确保文件为.xlsx或.xls格式  |
| 500    | 文件处理失败       | 检查文件格式是否正确        |

### 2. 查询导入进度

**接口描述**：根据任务ID查询Excel导入的实时进度

**请求方法**：GET

**URL**：`/api/import/progress/{taskId}`

**路径参数**：

| 参数名 | 类型   | 必填 | 说明                        |
|--------|--------|------|----------------------------|
| taskId | String | 是   | 导入任务ID，上传接口返回值  |

**响应参数**：

| 参数名        | 类型          | 说明                               |
|---------------|---------------|-----------------------------------|
| data.taskId   | String        | 任务ID                            |
| data.state    | String        | 任务状态：PENDING/PROCESSING/COMPLETED/FAILED |
| data.progress | Double        | 进度百分比，范围0.0-1.0           |
| data.totalRows | Integer      | Excel总行数(不含表头)             |
| data.processedRows | Integer  | 已处理行数                        |
| data.successRows | Integer    | 成功导入行数                      |
| data.failedRows | Integer[]   | 导入失败的行号列表                |
| data.errors   | String[]      | 错误信息列表                      |
| data.error    | String        | 任务级别错误信息                  |

**响应示例**：
```json
{
  "success": true,
  "code": "200",
  "message": "操作成功",
  "data": {
    "taskId": "import-task-20240318-a1b2c3",
    "state": "PROCESSING",
    "progress": 0.75,
    "totalRows": 1000,
    "processedRows": 750,
    "successRows": 740,
    "failedRows": [12, 45, 78],
    "errors": [
      "第12行：资产编号格式错误",
      "第45行：必填字段'设备型号'为空",
      "第78行：分类路径无效"
    ],
    "error": null
  },
  "timestamp": 1618037235000
}
```

**错误码**：

| 错误码 | 描述               | 解决方案                   |
|--------|--------------------|-----------------------------|
| 500    | 任务不存在或已过期 | 检查taskId是否正确，或任务是否已过期 |

### 3. 获取导入结果统计

**接口描述**：根据批次ID查询导入完成后的统计结果

**请求方法**：GET

**URL**：`/api/import/result/{batchId}`

**路径参数**：

| 参数名  | 类型   | 必填 | 说明                                  |
|---------|--------|------|--------------------------------------|
| batchId | String | 是   | 导入批次ID，格式：IMPORT-yyyyMMddHHmmss-xxxx |

**响应参数**：

| 参数名             | 类型          | 说明                       |
|--------------------|---------------|---------------------------|
| data.batchId       | String        | 导入批次ID                |
| data.importTime    | LocalDateTime | 导入完成时间              |
| data.totalAssets   | Long          | 总资产数                  |
| data.successCount  | Long          | 成功导入数                |
| data.failedCount   | Long          | 导入失败数                |
| data.importUser    | String        | 导入操作执行人            |
| data.costTime      | Double        | 导入耗时(秒)              |

**响应示例**：
```json
{
  "success": true,
  "code": "200",
  "message": "操作成功",
  "data": {
    "batchId": "IMPORT-20240318120530-a1b2c3",
    "importTime": "2024-03-18T12:10:45",
    "totalAssets": 1000,
    "successCount": 985,
    "failedCount": 15,
    "importUser": "admin",
    "costTime": 25.6
  },
  "timestamp": 1618037235000
}
```

## 数据模型

### 资产主表（AssetMaster）
系统核心数据模型，存储IT资产信息。

主要字段：
- assetId: 主键ID
- assetUuid: 资产UUID（业务唯一标识）
- assetNo: 资产编号（业务编码）
- assetName: 资产名称
- currentStatus: 资产状态（IN_USE/INVENTORY/MAINTENANCE/RETIRED）
- categoryHierarchy: 分类层级（JSON格式）
- space: 空间位置（关联SpaceTimeline）
- warranty: 维保信息（关联WarrantyContract）
- importBatch: 导入批次号

### 维保合约（WarrantyContract）
存储资产维保合同信息。

主要字段：
- warrantyId: 主键ID
- contractNo: 合同编号
- startDate: 维保开始日期
- endDate: 维保结束日期
- provider: 维保提供商
- warrantyLevel: 维保级别

### 空间时间线（SpaceTimeline）
记录资产位置变更历史。

主要字段：
- spaceId: 主键ID
- locationPath: 位置路径
- buildingName: 建筑名称
- floorNo: 楼层号
- roomName: 房间名称

### 变更追踪（ChangeTrace）
记录资产状态变更历史。

主要字段：
- traceId: 主键ID
- assetId: 资产ID
- traceType: 变更类型
- oldStatus: 旧状态
- newStatus: 新状态
- changeTime: 变更时间
- operator: 操作人

## 注意事项

1. Excel导入建议使用系统提供的模板
2. 大规模数据导入可能需要较长处理时间
3. 批量导入建议单次不超过5000条数据
4. 所有时间格式均为ISO-8601标准（yyyy-MM-ddTHH:mm:ss） 